const canvas=document.getElementById("main_screen"),context=canvas.getContext("2d");var pressedKeys={};window.onkeyup=function(e){pressedKeys[e.keyCode]=!1},window.onkeydown=function(e){pressedKeys[e.keyCode]=!0};const titleScreen=document.getElementById("title-screen"),layers=[document.getElementById("parallax-mountain-bg"),document.getElementById("parallax-mountain-montain-far"),document.getElementById("parallax-mountain-mountains"),document.getElementById("parallax-mountain-trees"),document.getElementById("parallax-mountain-foreground-trees")],tiles=document.getElementById("tiles"),heroIdleAnimationLeft=document.getElementById("hero-idle-left"),heroIdleAnimationRight=document.getElementById("hero-idle-right"),heroRunAnimationLeft=document.getElementById("hero-run-left"),heroRunAnimationRight=document.getElementById("hero-run-right"),heroJumpAnimationLeft=document.getElementById("hero-jump-left"),heroJumpAnimationRight=document.getElementById("hero-jump-right"),heroAttackAnimationLeft=document.getElementById("hero-attack-left"),heroAttackAnimationRight=document.getElementById("hero-attack-right"),heroCrouchAnimationLeft=document.getElementById("hero-crouch-left"),heroCrouchAnimationRight=document.getElementById("hero-crouch-right"),heroHurtAnimationLeft=document.getElementById("hero-hurt-left"),heroHurtAnimationRight=document.getElementById("hero-hurt-right");let heroAnimations=[[heroIdleAnimationLeft,4],[heroIdleAnimationRight,4],[heroRunAnimationLeft,6],[heroRunAnimationRight,6],[heroJumpAnimationLeft,4],[heroJumpAnimationRight,4],[heroAttackAnimationLeft,5],[heroAttackAnimationRight,5],[heroCrouchAnimationLeft,1],[heroCrouchAnimationRight,1],[heroHurtAnimationLeft,1],[heroHurtAnimationRight,1]],heroAnimationIndex=1,heroDirection=1,heroJumping=!1,heroPeakJumping=!1,jumpPressedLastFrame=!1,hoverjump=!1;var scrollX=0,resetAnimationTime=Date.now(),previousHeroAnimationIndex=1;let currentLevel=[],points=0,gameStarted=!1,gameOver=!1,demoComplete=!1;var levels=[[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,8,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,4,1,0,0,0,0,0,1,6,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[8,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[9,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[9,3,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,6,1,0,0,0,1,4,1,0,0,0,0,0,0,0,0,8,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,8,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,9,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,4,5,6,1,1,1,1,1,1,0,0,0,0,3,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,1,1,1,1,1,1,3,0,0,0,8,0,0,0,0,8,0,0,0,0,1,1,1,1,2,3,4,5,4,3,2,1,1,1,1,0,0,0,0,5,0,0,0,1,6,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1]]];const SCREEN_WIDTH=816,SCREEN_HEIGHT=480,TILE_SIZE=32;let distanceFromFloor=0,nearestFloorHeight=-59,newJumpPress=!1,attackCompleted=!1,hero={spriteWidth:100,spriteHeight:59,levelX:140,levelY:389,renderX:100,renderY:389,velocityY:0};var audioElement=document.getElementById("theAudio");audioElement.load(),audioElement.volume=.6;var audioPlaying=!1,enterPressedInitially=!1,beyondTitleScreen=!1;onInitialEnterPress=function(e){"Enter"==e.key&&(enterPressedInitially=!0,audioElement.play())},document.addEventListener("keypress",onInitialEnterPress);var drawTile=function(e,t,o){var n=32*o-64*Math.floor(o/64)*32,r=32*Math.floor(o/64);context.drawImage(tiles,n,r,32,32,e,t,32,32)},drawLevelTiles=function(e,t,o,n){for(var r=0;r<t;r++)for(var i=0;i<o;i++)1==e[i][r]?drawTile(32*r-n,32*i,210):10==e[i][r]?drawTile(32*r-n,32*i,625):12==e[i][r]?drawTile(32*r-n,32*i,87):0!=e[i][r]&&drawTile(32*r-n,32*i,41+e[i][r]+384)},checkSpriteTileCollision=function(e,t,o,n,r){if(e.levelX+e.spriteWidth>=t&&e.levelX<=t+32&&e.levelY+e.spriteHeight>=o&&e.levelY<=o+32){let n={x:Math.max(e.levelX,t),y:Math.max(e.levelY,o)};n.width=Math.min(e.levelX+e.spriteWidth,t+32)-n.x,n.height=Math.min(e.levelY+e.spriteHeight,o+32)-n.y,e.levelX+e.spriteWidth/2>t+16&&n.height>n.width&&(r.left=!0),e.levelX+e.spriteWidth/2<t+16&&n.height>n.width&&(r.right=!0),e.levelY+e.spriteHeight/2<o+16&&n.width>n.height&&n.width>4&&(r.top=!0,r.topY=o),e.levelY+e.spriteHeight/2>o+16&&n.width>n.height&&n.width>4&&(r.bottom=!0)}},checkSpriteTileCollisions=function(e,t){let o=t[0].length,n=t.length,r={left:!1,right:!1,top:!1,bottom:!1,topY:null};for(let i=0;i<o;i++)for(let o=0;o<n;o++)0!=t[o][i]&&checkSpriteTileCollision(e,32*i,32*o,t[o][i],r);return r},resetGame=function(){hero={spriteWidth:100,spriteHeight:59,levelX:140,levelY:389,renderX:100,renderY:389,velocityY:0},currentLevel=JSON.parse(JSON.stringify(levels[0])),scrollX=0,points=0,hoverjump=!1,heroAnimationIndex=1,heroDirection=1,heroJumping=!1,heroPeakJumping=!1,jumpPressedLastFrame=!1,hoverjump=!1,scrollX=0,resetAnimationTime=Date.now(),previousHeroAnimationIndex=1,points=0,distanceFromFloor=0,nearestFloorHeight=-59,newJumpPress=!1,attackCompleted=!1},titleScreenLoop=function(e,t){context.drawImage(titleScreen,0,0,384,224,0,0,816,480),context.font="90px Luminari, fantasy",context.fillStyle="rgb(242,131,28)",context.fillText("Platform Pillage",75,140),context.font="60px Luminari, fantasy",context.fillStyle="rgb(255, 247, 227, "+(.75+.15*Math.cos(Math.round(e-t)/1e3*6.283))+")",context.fillText("Press Enter",240,260);let o=Math.floor(Date.now()/100%heroAnimations[heroAnimationIndex][1]);context.drawImage(heroAnimations[heroAnimationIndex][0],o*hero.spriteWidth,0,hero.spriteWidth,hero.spriteHeight,308,280,200,118),(pressedKeys[13]||enterPressedInitially&&!beyondTitleScreen)&&(gameStarted=!0,beyondTitleScreen=!0)},gameOverScreen=function(e,t){context.fillStyle="black",context.fillRect(0,0,816,480),context.font="90px Luminari, fantasy",context.fillStyle="red",context.fillText("Game Over",170,140),context.font="60px Luminari, fantasy",context.fillStyle="rgb(255, 247, 227, "+(.5+.1*Math.cos(Math.round(e-t)/1e3*6.283))+")",context.fillText("Press ESC to Exit",170,260);let o=Math.floor(Date.now()/100%heroAnimations[11][1]);context.drawImage(heroAnimations[11][0],o*hero.spriteWidth,0,hero.spriteWidth,hero.spriteHeight,308,280,200,118),pressedKeys[27]&&(resetGame(),gameOver=!1)},demoCompleteScreen=function(e,t){context.fillStyle="rgb(67, 67, 67)",context.fillRect(0,0,816,480),context.font="90px Luminari, fantasy",context.fillStyle="#4BB543",context.fillText("Level Complete",90,140),context.font="60px Luminari, fantasy",context.fillStyle="white";const o=(e,t)=>String(e).padStart(t,"0");context.fillText("Score: "+o(points,5)+" Pts",180,220),context.font="50px Luminari, fantasy",context.fillStyle="rgb(255, 247, 227, "+(.5+.1*Math.cos(Math.round(e-t)/1e3*6.283))+")",context.fillText("Press ESC to Exit",200,290),context.font="14px Luminari, fantasy","10800"===o(points,5)&&context.fillText("V€LLi KézhaMai K@laiLA Mažhai Pei¥um",560,470);let n=Math.floor(Date.now()/100%heroAnimations[3][1]);context.drawImage(heroAnimations[3][0],n*hero.spriteWidth,0,hero.spriteWidth,hero.spriteHeight,308,280,200,118),pressedKeys[27]&&(resetGame(),demoComplete=!1)},gameLoop=function(e){context.clearRect(0,0,canvas.width,canvas.height),(hero.levelX+hero.spriteWidth/2>=408&&scrollX+816<32*currentLevel[0].length||hero.levelX+408+hero.spriteWidth/2<=32*currentLevel[0].length&&scrollX>0)&&(scrollX=hero.levelX-408+hero.spriteWidth/2),hero.renderX=hero.levelX-scrollX,hero.renderY=hero.levelY;for(var t=0;t<layers.length;t++)if(0==t)context.drawImage(layers[t],0,0,816,480);else{var o=.005*scrollX*Math.pow(2,t);o-=1==t?0:4==t?263*Math.floor(o/263):272*Math.floor(o/272);context.drawImage(layers[t],o,0,272,160,0,0,816,480)}drawLevelTiles(currentLevel,currentLevel[0].length,currentLevel.length,scrollX);let n=Math.floor((Date.now()-resetAnimationTime)/100%heroAnimations[heroAnimationIndex][1]);4!=heroAnimationIndex&&5!=heroAnimationIndex||!heroJumping||n!=heroAnimations[heroAnimationIndex][1]-1||(heroPeakJumping=!0),4!=heroAnimationIndex&&5!=heroAnimationIndex||!heroPeakJumping||(n=heroAnimations[heroAnimationIndex][1]-1),0==heroDirection&&(n=heroAnimations[heroAnimationIndex][1]-n-1),context.drawImage(heroAnimations[heroAnimationIndex][0],n*hero.spriteWidth,0,hero.spriteWidth,hero.spriteHeight,hero.renderX,hero.renderY,hero.spriteWidth,hero.spriteHeight);let r=checkSpriteTileCollisions({levelX:hero.levelX+25,levelY:hero.levelY,spriteWidth:50,spriteHeight:hero.spriteHeight},currentLevel);pressedKeys[65]&&(hero.levelX>-25&&!r.left&&(hero.levelX-=240*e),heroAnimationIndex=2,heroDirection=0),pressedKeys[68]&&(hero.levelX+hero.spriteWidth-25-30<32*currentLevel[0].length&&!r.right&&(hero.levelX+=240*e),heroAnimationIndex=3,heroDirection=1),pressedKeys[65]||pressedKeys[68]||(heroAnimationIndex=heroDirection?1:0),pressedKeys[83]&&(heroAnimationIndex=heroDirection?9:8),pressedKeys[75]?heroDirection?(4==n&&7==previousHeroAnimationIndex&&(attackCompleted=!0),heroAnimationIndex=attackCompleted&&pressedKeys[68]?3:!attackCompleted||pressedKeys[65]||pressedKeys[68]?7:1):(0==n&&6==previousHeroAnimationIndex&&(attackCompleted=!0),heroAnimationIndex=attackCompleted&&pressedKeys[65]?2:!attackCompleted||pressedKeys[65]||pressedKeys[68]?6:0):attackCompleted=!1,pressedKeys[87]?((distanceFromFloor>0||hoverjump)&&(heroAnimationIndex=heroDirection?5:4),heroJumping=!0):(heroJumping=!1,heroPeakJumping=!1),previousHeroAnimationIndex!=heroAnimationIndex&&(resetAnimationTime=Date.now()),nearestFloorHeight=hero.velocityY>=0&&r.top?480-r.topY:-hero.spriteHeight,distanceFromFloor=480-nearestFloorHeight-(hero.levelY+hero.spriteHeight),!(distanceFromFloor>0)||hoverjump&&heroJumping?hero.velocityY=0:hero.velocityY+=.5,distanceFromFloor<=0&&(hero.levelY=480-nearestFloorHeight-hero.spriteHeight),hoverjump?(newJumpPress=!(!heroJumping||newJumpPress),newJumpPress&&(hero.velocityY=-4)):(newJumpPress=!(!(heroJumping&&!newJumpPress&&distanceFromFloor<=0)||jumpPressedLastFrame),newJumpPress&&(hero.levelY-=1,hero.velocityY=-10)),(hero.velocityY>0&&r.top||hero.velocityY<0&&hero.levelY<=-10||hero.velocityY<0&&r.bottom)&&(hero.velocityY=0),hero.levelY+=hero.velocityY;let i={top:!1,topY:null,bottom:!1,left:!1,right:!1};checkSpriteTileCollision({levelX:hero.levelX+25,levelY:hero.levelY,spriteWidth:50,spriteHeight:hero.spriteHeight},2624,416,10,i),(i.top||i.bottom||i.left||i.right)&&(10==currentLevel[13][82]&&(points+=800,currentLevel[13][82]=0),hoverjump=!0);let l={top:!1,topY:null,bottom:!1,left:!1,right:!1};checkSpriteTileCollision({levelX:hero.levelX+25,levelY:hero.levelY,spriteWidth:50,spriteHeight:hero.spriteHeight},3264,64,10,l),(l.top||l.bottom||l.left||l.right)&&12==currentLevel[2][102]&&(points+=1e4,currentLevel[2][102]=0),jumpPressedLastFrame=pressedKeys[87],previousHeroAnimationIndex=heroAnimationIndex,hero.levelX+hero.spriteWidth/2>=32*currentLevel[0].length&&(demoComplete=!0,gameStarted=!1),hero.levelY>=480&&(gameOver=!0,gameStarted=!1)};let FPS=60,interval=1/FPS,frameCounter=0,oldTime=Date.now(),previousFrameTime=oldTime;function preventDevTools(){document.addEventListener("contextmenu",(e=>e.preventDefault())),document.addEventListener("keydown",(e=>{const t=e.key.toLowerCase();if("f12"===t||e.ctrlKey&&e.shiftKey&&["i","j","c"].includes(t)||e.ctrlKey&&"u"===t||e.metaKey&&e.altKey&&"i"===t)return e.preventDefault(),e.stopPropagation(),!1}));setInterval((()=>{const e=window.outerWidth-window.innerWidth,t=window.outerHeight-window.innerHeight;(e>160||t>160)&&function(){throw document.body.innerHTML="",document.body.style.background="#000",document.body.style.color="#0f0",document.body.style.fontFamily="monospace",document.body.innerHTML="<h1>Access Denied</h1>",new Error("DevTools detected")}()}),1e3),setInterval((()=>{}),500)}currentLevel=JSON.parse(JSON.stringify(levels[0])),setInterval((function(){let e=Date.now();gameStarted?(audioPlaying||(audioElement.currentTime=0,enterPressedInitially&&(audioElement.play(),document.removeEventListener("keypress",onInitialEnterPress)),audioPlaying=!0),gameLoop(interval),context.font="28px Luminari, fantasy",context.fillStyle="rgb(255, 247, 227)",context.fillText(points+" Pts",10,50)):gameOver?(audioPlaying&&(audioElement.pause(),audioPlaying=!1),gameOverScreen(e,oldTime)):demoComplete?demoCompleteScreen(e,oldTime):(audioPlaying&&(audioElement.pause(),audioPlaying=!1),titleScreenLoop(e,oldTime)),previousFrameTime=e,frameCounter++,e-oldTime>1e3&&(frameCounter=0,oldTime=Date.now())}),1e3*interval),window.addEventListener("load",preventDevTools);